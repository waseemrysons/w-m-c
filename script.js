class WholesaleMarginCalculator{constructor(){this.initElements(),this.initEventListeners(),this.loadHistory(),this.initChart(),this.setupThemeToggle()}initElements(){this.elements={cost:document.getElementById("cost"),margin:document.getElementById("margin"),salesPrice:document.getElementById("salesPrice"),profit:document.getElementById("profit"),markupPercentage:document.getElementById("markupPercentage"),errorMessage:document.getElementById("errorMessage"),historyContainer:document.getElementById("historyContainer"),calculationHistory:document.getElementById("calculationHistory"),resetBtn:document.getElementById("resetBtn"),saveBtn:document.getElementById("saveBtn"),profitChart:document.getElementById("profitChart"),themeToggle:document.getElementById("themeToggle"),themeIcon:document.getElementById("themeIcon")}}initEventListeners(){[this.elements.cost,this.elements.margin,this.elements.salesPrice].forEach((e=>e.addEventListener("input",this.calculateMargin.bind(this)))),this.elements.resetBtn.addEventListener("click",this.resetCalculator.bind(this)),this.elements.saveBtn.addEventListener("click",this.saveCalculation.bind(this))}calculateMargin(){try{const e=this.sanitizeInput(this.elements.cost.value),t=this.sanitizeInput(this.elements.salesPrice.value),s=this.sanitizeInput(this.elements.margin.value);if(e<0||t<0||s<0)throw new Error("Negative values not allowed");const n=t-e,i=((t-e)/e*100).toFixed(2);this.elements.profit.textContent=n.toFixed(2),this.elements.markupPercentage.textContent=`${i}%`,this.updateChart(e,t,n),this.clearError()}catch(e){this.showError(e.message)}}sanitizeInput(e){const t=parseFloat(String(e).trim());return isNaN(t)?0:t}saveCalculation(){const e=this.sanitizeInput(this.elements.cost.value),t=this.sanitizeInput(this.elements.salesPrice.value);if(0===e||0===t)return void this.showError("Please enter valid cost and sales price");const s={timestamp:(new Date).toISOString(),cost:this.elements.cost.value,salesPrice:this.elements.salesPrice.value,profit:this.elements.profit.textContent,markup:this.elements.markupPercentage.textContent},n=this.getHistory();n.unshift(s),localStorage.setItem("calculationHistory",JSON.stringify(n.slice(0,10))),this.renderHistory()}getHistory(){const e=localStorage.getItem("calculationHistory");return e?JSON.parse(e):[]}renderHistory(){const e=this.getHistory(),t=this.elements.calculationHistory;t.innerHTML="",e.forEach(((e,s)=>{const n=document.createElement("div");n.className="bg-gray-50 dark:bg-gray-700 p-3 rounded-md flex justify-between items-center",n.innerHTML=`\n                <div>\n                    <div class="text-xs text-gray-500 dark:text-gray-400">${new Date(e.timestamp).toLocaleString()}</div>\n                    <div class="flex space-x-2">\n                        <span>Cost: £${e.cost}</span>\n                        <span>Sales: £${e.salesPrice}</span>\n                        <span>Profit: ${e.profit}</span>\n                    </div>\n                </div>\n                <button class="text-red-500 hover:text-red-700 transition">\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>\n                    </svg>\n                </button>\n            `;n.querySelector("button").addEventListener("click",(()=>this.deleteHistory(s))),t.appendChild(n)})),this.elements.historyContainer.style.display=e.length?"block":"none"}deleteHistory(e){const t=this.getHistory();t.splice(e,1),localStorage.setItem("calculationHistory",JSON.stringify(t)),this.renderHistory()}resetCalculator(){[this.elements.cost,this.elements.margin,this.elements.salesPrice].forEach((e=>e.value="")),this.elements.profit.textContent="0.00",this.elements.markupPercentage.textContent="0%",this.clearError(),this.updateChart(0,0,0)}showError(e){this.elements.errorMessage.textContent=e,this.elements.errorMessage.classList.remove("hidden")}clearError(){this.elements.errorMessage.textContent="",this.elements.errorMessage.classList.add("hidden")}initChart(){this.chart=new Chart(this.elements.profitChart,{type:"line",data:{labels:[],datasets:[{label:"Profit Trend",data:[],borderColor:"rgb(75, 192, 192)",tension:.1}]},options:{responsive:!0,plugins:{legend:{display:!1}}}})}updateChart(e,t,s){if(!this.chart)return;const n=this.chart.data.labels,i=this.chart.data.datasets[0].data;n.push((new Date).toLocaleTimeString()),i.push(s),n.length>10&&(n.shift(),i.shift()),this.chart.update()}setupThemeToggle(){const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)");console.log("Saved Theme:",e),console.log("Prefers Dark:",t.matches),e?document.documentElement.classList.toggle("dark","dark"===e):document.documentElement.classList.toggle("dark",t.matches),this.elements.themeToggle.addEventListener("click",(()=>{const e=document.documentElement.classList.toggle("dark");console.log("Dark class applied:",e);const t=e?"dark":"light";localStorage.setItem("theme",t),this.updateThemeIcon()})),this.updateThemeIcon()}updateThemeIcon(){const e=document.documentElement.classList.contains("dark");document.getElementById("themeIcon").querySelector("path").setAttribute("d",e?"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z":"M12 3v1m0 16v1m9-9h-1M4 12H3m3.343-5.657L5.93 5.93m12.728 12.728 1.414-1.414M6.343 6.343l-1.414-1.414m12.728 12.728L17.657 17.657")}loadHistory(){this.renderHistory()}}document.addEventListener("DOMContentLoaded",(()=>new WholesaleMarginCalculator));